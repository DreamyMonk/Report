rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function isAppUser() {
      return request.auth != null && ('role' in request.auth.token && (request.auth.token.role == 'admin' || request.auth.token.role == 'officer'));
    }

    match /users/{userId} {
      allow read, write: if isAppUser();
    }
    
    match /reports/{reportId} {
      allow list: if isAppUser();
      allow read, write: if isAppUser();
      
      match /messages/{messageId} {
        allow list, read, write: if isAppUser();
      }
      
      match /attachments/{attachmentId} {
         allow list, read, write: if isAppUser();
      }
    }
    
    match /statuses/{statusId} {
      allow read: if true;
      allow write: if isAppUser();
    }
    
    match /categories/{categoryId} {
       allow read: if true;
       allow write: if isAppUser();
    }
    
    match /shared_reports/{shareId} {
      allow read, write: if true; // Publicly accessible for link sharing
    }

    match /content/{contentId} {
        allow read: if true;
        allow write: if isAppUser();
    }
    
    match /audit_logs/{logId} {
      allow list, read, write: if isAppUser();
    }
  }
}
